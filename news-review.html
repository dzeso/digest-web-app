<script type="text/x-template" id="news-review-template">
        <v-card v-if="!isNewsReadonly(article)">
          <v-toolbar color="primary" class="mx-1">
            <v-btn @click.native="saveEdited" icon>
              <v-icon color="white">save</v-icon>
            </v-btn>
            <v-btn @click.native="deleteEdited" icon>
              <v-icon color="white">delete</v-icon>
            </v-btn>
            <v-spacer></v-spacer>
            <v-btn icon>
              <v-icon color="white">more_vert</v-icon>
            </v-btn>
          </v-toolbar>
          <v-container fluid class="px-3">
            <v-layout row wrap>
              <v-flex xs12>
                <star-rating 
                  label="Рейтинг новости" 
                  v-model="rating" 
                  :show-rating="false" 
                  :read-only="readonly" 
                  @rating-selected="saveData"
                ></star-rating>
              </v-flex>
              <v-flex xs12>
                <v-select
                  :items="rubric"
                  v-model="selectedRubrics"
                  label="Укажите рубрики для новости"
                  multiple
                  chips
                  item-text="nm"
                  item-value="id"
                  :readonly="readonly"
                  @change="saveData"
                ></v-select>
              </v-flex>
              <v-flex xs12>
                <v-text-field
                  label="Комментарий"
                  :rules="[(v) => v.length <= 1024 || 'Max 1024 characters']"
                  :counter="1024"
                  v-model.trim="comment"
                  multi-line
                  :readonly="readonly"
                  @change="saveData"
                ></v-text-field>
              </v-flex>
            </v-layout>
          </v-container>
        </v-card>
</script>

<script>
console.log ("newsReview started");
var newsReview = {
    template: '#news-review-template', 
    props: ['article'],
    name: 'news-review',
    methods: {
      saveEdited () {
        return ;
      },
      saveData () {
//        console.log("newsReview saveData", EDIT_STATE("EDIT").id);
        this.$store.dispatch('saveEditedNews', {
          id: this.article.id, rubrics: this.selectedRubrics, rating: this.rating, comment: this.comment,
          mode: EDIT_MODE("EDIT").id, state: EDIT_STATE("EDIT").id});
      },
    },
    computed: {
        
      rubric () {
        console.log ("newsReview rubric", indexedObjectToArray(this.$store.getters.rubric));
        return indexedObjectToArray(this.$store.getters.rubric);
        },
        
       isNewsReadonly (article) {  
         return (article) => {
           return !this.$store.getters.userCanEdit && this.$store.getters.isNewsReadonly(article);
           } 
         },
    },
    components: {
       StarRating: VueStarRating.default
       },
    data () {
      return {
        selectedRubrics: this.$store.getters.editedNews[this.article.id] ? this.$store.getters.editedNews[this.article.id].rubrics : this.article.rubrics,
        comment:  this.$store.getters.editedNews[this.article.id] ? this.$store.getters.editedNews[this.article.id].comment : "",
        rating: this.$store.getters.editedNews[this.article.id] ? this.$store.getters.editedNews[this.article.id].rating : 0,
//        iconDelete: EDIT_STATE("DELETE").icon,
//        iconEdit: EDIT_MODE("EDIT").icon,
//        iconUpload: EDIT_MODE("EDIT").icon,
//        modeDelete: EDIT_STATE("DELETE"),
        readonly: false
      }
    }
};
</script>


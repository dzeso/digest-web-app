<style>

</style>

<script type="text/x-template" id="news-view-list-template">
  <v-expansion-panel popout>
    <v-expansion-panel-content lazy v-for="article in news" :key=article.id @input="markArticle($event, article.id)">
      <div slot="header">
        <news-view-header :article=article></news-view-header>
      </div>
      <v-card>
        <v-divider class="dark"></v-divider>
        <v-card-text>
          <news-view-body :article=article></news-view-body>
          <news-view-references :article="article"></news-view-references>
        </v-card-text>
      </v-card>
      <news-review :article=article></news-review>
    </v-expansion-panel-content>
  </v-expansion-panel>
</script>

<script>
var newsViewList = {
    template: '#news-view-list-template',      
    props: ['mode'],
    components: {
       NewsViewHeader: newsViewHeader,
       NewsViewBody: newsViewBody,
       NewsReview: newsReview,
       NewsViewReferences: newsViewReferences
    },
    activated: function () {
      console.log('--- activated  newsViewList' + this.mode)
    },
    deactivated: function () {
      console.log('--- deactivated  newsViewList' + this.mode)
    },
    methods: {
      markArticle (v, id) {
        if (!v) {
          this.setRead(id);
          this.setEdited(id);
        }
        console.log(v, id)
      },
      setRead: function (id) {
          console.log ("news-view-list-template - setRead", id, this.$store.getters.unreadIndex[id]);
          if (this.$store.getters.unreadIndex[id]) this.$store.dispatch("removeFromUnreadIndex", id);
        },
      setEdited: function (id) {
          console.log ("news-view-list-template - setEdited", id, this.$store.getters.lastEditedNewsIndex);
          if (this.$store.getters.lastEditedNewsIndex) {
            this.$store.commit('setObjReactive', this.$store.getters.editedNews);
            this.$store.commit("setLastEditedNewsIndex", 0);
            }
        },
      setUnRead: function (id) {
          console.log ("news-view-list-template - setUnRead", id);
          const unreadIndex = {id: id, type: UNREAD_TYPE('UNREAD')};
          this.$store.commit("insertUnreadIndex", unreadIndex);
          this.$store.commit('setObjReactive', this.$store.getters.unreadIndex);
          console.log ("news-view-list-template - unreadIndex", unreadIndex);
          ls_async_WriteTable({db: this.$store.getters.ls.db["user_profile"], table: "unread", index: "id", data: [unreadIndex]});
        }  
    },
    computed: {
      
      news () { 
        console.log ("news-view-list-template - mode", this.mode);
        switch(this.mode) {
          case "unread": return this.$store.getters.unreadNews;
          case "todo": return this.$store.getters.todoNews;
          case "all": return this.$store.getters.news;
          }
        return []; 
        },
      unreadIndex () { return this.$store.getters.unreadIndex; },
      unreadTypeClass () { return  this.$store.getters.ui.unreadType; },
      isNewsReadonly (article) {  
       return (article) => {
          return !this.$store.getters.userCanEdit && this.$store.getters.isNewsReadonly(article);
          } 
       },
      
      },    
   data: function () {
      return {
//        period: "тут будет указан период",
//        filterState: "состояние фильтра",
//        digestState: "количество строк и пр",
//        soursesList: "ria.ru",
        }
    }
  };

console.log ("newsViewList started");
</script>

